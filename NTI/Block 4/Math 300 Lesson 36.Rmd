---
title: "Math 300 NTI Lesson 36"
subtitle: "Regression Inference via Simulation"
author: "Professor Bradley Warner"
date: "`r format(Sys.time(), '%B, %Y')`"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: yes
    css: NTI.css
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
library(knitr)
library(kableExtra)
knitr::opts_chunk$set(echo = TRUE)
```

## Objectives

1. Construct and interpret bootstrap confidence intervals, both percentile and standard error method, for regression parameters such as slope and correlation coefficient.

2. Conduct and interpret a permutation test on the regression slope parameter. 


## Reading

[Chapter 10.4](https://moderndive.com/10-inference-for-regression.html#infer-regression)

## Lesson

Work through the learning check LC 10.2

+ We don't have to worry about normality and equality of variance for this lesson.

+ The confidence intervals are similar to what we have done before. The permutation test requires to be careful and think about the procedure. 

------------------------------------------------------------------------

### Libraries

```{r warning=FALSE,message=FALSE}
library(tidyverse)
library(infer)
library(moderndive)
```

## Review

Let's review the permutation test from the reading.  

### Data and model

Let's get the data and model again.

```{r}
evals_ch5 <- evals %>%
  select(ID, score, bty_avg, age)
glimpse(evals_ch5)
```

```{r}
score_model <- lm(score ~ bty_avg, data = evals_ch5)
```

And the regression summary.

```{r}
get_regression_table(score_model)
```

This table is for reference.

### Permutation Test

The hypothesis test is

$$
H_O:\beta_1=0
$$

$$
H_A:\beta_1\neq0
$$

Under the null, there is no linear relationship between teaching scores and beauty scores. Thus under the null hypothesis, we could just shuffle the beauty scores and calculate the slope. This would give us an estimate of the sampling distribution of the slope under the null hypothesis.

Here is the code from the `infer` package:

```{r}
null_distn_slope <- evals %>% 
  specify(score ~ bty_avg) %>%
  hypothesize(null = "independence") %>% 
  generate(reps = 1000, type = "permute") %>% 
  calculate(stat = "slope")
```

```{r}
visualize(null_distn_slope)
```  

It is centered at zero since this is the assumed value under the null distribution.

To find the p-value, we need the observed slope.

```{r}
(observed_slope <- evals %>% 
  specify(score ~ bty_avg) %>% 
  calculate(stat = "slope"))
```


```{r}
visualize(null_distn_slope) +
  shade_p_value(obs_stat = observed_slope, direction = "both")
```  


The p-value is going to be small.

```{r}
null_distn_slope %>% 
  get_p_value(obs_stat = observed_slope, direction = "both")
```

Based on the data we reject the null hypothesis of no linear relationship between beauty score and teaching score.


***

```{r, include=FALSE, purl=FALSE}
chap <- 10
lc <- 1
```

## Learning Check 10.2 (Objectives 1 and 2)

**`r paste0("(LC", chap, ".", (lc <- lc + 1), ")")`** Repeat the inference but this time for the correlation coefficient instead of the slope. Note the implementation of `stat = "correlation"` in the `calculate()` function of the `infer` package.

### Confidence Intervale

```{r}
set.seed(839)
bootstrap_distn_corr <- evals_ch5 %>%
  specify(formula = score ~ bty_avg) %>%
  generate(reps = 1000, type = "bootstrap") %>%
  calculate(stat = "correlation")
```


```{r}
percentile_ci <- bootstrap_distn_corr %>% 
  get_confidence_interval(type = "percentile", level = 0.95)
percentile_ci
```


```{r}
visualize(bootstrap_distn_corr) +
  theme_classic()
```  

Fairly symmetric, so we will use the standard error method as well.

```{r}
(observed_corr <- evals %>%
  specify(score ~ bty_avg) %>%
  calculate(stat = "correlation"))
```

```{r}
(std_err<-bootstrap_distn_corr %>% 
  get_confidence_interval(point_estimate = observed_corr, type = "se", level = 0.95))
```  


Since the confidence interval does not include zero, we are 95% confident that the correlation between beauty score and teaching score in positive and between 0.1 and 0.3.

### Hypothesis Test

The hypothesis test is

$$
H_O:\rho=0
$$

$$
H_A:\rho\neq0
$$

```{r}
set.seed(2001)
null_distn_corr <- evals %>% 
  specify(score ~ bty_avg) %>%
  hypothesize(null = "independence") %>% 
  generate(reps = 1000, type = "permute") %>% 
  calculate(stat = "correlation")
```

```{r}
visualize(null_distn_corr) +
  shade_p_value(obs_stat = observed_corr, direction = "both")
```  

It is centered at zero since this is the assumed value under the null distribution. The p-value will be small.

The p-value is going to be small.

```{r}
null_distn_corr %>% 
  get_p_value(obs_stat = observed_corr, direction = "both")
```  


Based on the data we reject the null hypothesis of no correlation between beauty score and teaching score.



***


## Documenting software

-   File creation date: `r Sys.Date()`
-   `r R.version.string`
-   `tidyverse` package version: `r packageVersion("tidyverse")`
-   `moderndive` package version: `r packageVersion("moderndive")`
-   `infer` package version: `r packageVersion("infer")`

